<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Cake</title>
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="stylesheet" href="candle.css">


</head>
<body>


  <canvas id="confetti" aria-hidden="true"></canvas>


  <div class="card" id="card">
  
    <img class="cat" src="cat.gif" alt="Cat topper"/>


    <img class="poster" src="cake.png" alt="Birthday poster"/>

  
    <div class="flame intro" style="--delay:.34s; left:47%; top:40%;"></div>
    <div class="flame intro" style="--delay:.42s; left:52%; top:40%;"></div>
  </div>


  <img src="banner.png" class="top-banderitas" alt="Banderitas"/>


  <div id="finalOverlay" class="overlay" aria-hidden="true" role="dialog" aria-modal="true">
    <div class="overlay__backdrop" data-dismiss=""></div>
    <div class="overlay__content" role="document" tabindex="-1">
      <div class="overlay__msg">
        <p>
        <a style="color:red">══════════════♡❤︎⁠⁠˚ʚ♡ɞ˚❤︎♡══════════════⁠</a> <br><br> Happy Birthday babee kooo, my crushicakez, <br> thank youu for everything and sa mga moments natin together. I'm very thankful na nakilala kita hihi. <br><br> May you have more birthdays to come and may God bless you always. <br> I loveee youuuu so muchh mwahhhhh!!<br><br><a style="color:red">══════════════♡❤︎⁠⁠˚ʚ♡ɞ˚❤︎♡═══════════════⁠</a>
        </p>
      </div> 
      <button class="overlay__close" type="button" aria-label="Close" data-dismiss="">
        ✕
      </button>
    </div>
  </div>

<script>

const COLORS = ["#f94144","#f3722c","#f8961e","#f9c74f","#90be6d","#43aa8b","#577590","#4cc9f0","#b5179e","#ffd166"];
const canvas = document.getElementById('confetti');
const ctx = canvas.getContext('2d');
let dpr = Math.max(1, window.devicePixelRatio || 1);

function sizeCanvas(){
  canvas.width  = Math.floor(innerWidth * dpr);
  canvas.height = Math.floor(innerHeight * dpr);
  canvas.style.width = innerWidth + 'px';
  canvas.style.height = innerHeight + 'px';
  ctx.setTransform(dpr,0,0,dpr,0,0);
}
sizeCanvas(); addEventListener('resize', sizeCanvas);

const particles = [];
let rafId = null;

function spawnConfetti({x, y, count=90, spread=Math.PI, power=9, size=[5,8]}){
  for(let i=0;i<count;i++){
    const angle = (Math.random()*spread) - spread/2 + (-Math.PI/2);
    const speed = (Math.random()*0.6 + 0.7) * power;
    particles.push({
      x, y,
      vx: Math.cos(angle)*speed,
      vy: Math.sin(angle)*speed,
      w: Math.random()*(size[1]-size[0]) + size[0],
      h: Math.random()*(size[1]-size[0]) + size[0],
      color: COLORS[(Math.random()*COLORS.length)|0],
      rot: Math.random()*Math.PI*2,
      vr: (Math.random()*0.2 - 0.1),
      life: 120 + (Math.random()*60|0),
      alpha: 1
    });
  }
  if(!rafId) loop();
}

function loop(){
  const gravity = 0.18, drag = 0.992;
  function tick(){
    rafId = requestAnimationFrame(tick);
    ctx.clearRect(0,0,canvas.width,canvas.height);
    for(let i=particles.length-1;i>=0;i--){
      const p = particles[i];
      p.vx *= drag;
      p.vy = p.vy*drag + gravity;
      p.x += p.vx;
      p.y += p.vy;
      p.rot += p.vr;
      p.life--;
      if(p.life < 30) p.alpha = Math.max(0, p.life/30);
      if(p.y > innerHeight + 60 || p.life <= 0){ particles.splice(i,1); continue; }
      ctx.save();
      ctx.globalAlpha = p.alpha;
      ctx.translate(p.x, p.y);
      ctx.rotate(p.rot);
      ctx.fillStyle = p.color;
      ctx.fillRect(-p.w/2, -p.h/2, p.w, p.h);
      ctx.restore();
    }
    if(particles.length === 0){
      cancelAnimationFrame(rafId);
      rafId = null;
      ctx.clearRect(0,0,canvas.width,canvas.height);
    }
  }
  tick();
}


function centerOnScreen(el){
  const r = el.getBoundingClientRect();
  return { x: r.left + r.width/2, y: r.top + r.height/2 };
}
function puffAt(x, y){
  const puff = document.createElement('div');
  puff.className = 'smoke';
  puff.style.left = x+'px';
  puff.style.top  = y+'px';
  document.body.appendChild(puff);
  setTimeout(()=>puff.remove(), 700);
}
function allOut(){ return !document.querySelector('.flame.lit'); }


function startFlameFlicker(){
  document.querySelectorAll('.flame').forEach((f,i)=>{
    setTimeout(()=>{
      f.classList.remove('intro');
      f.classList.add('lit');
    }, 350 + i*120);
  });
}


const overlay = document.getElementById('finalOverlay');
const overlayContent = overlay?.querySelector('.overlay__content');

function openOverlay() {
  if (!overlay) return;
  overlay.classList.add('is-open');
  overlay.setAttribute('aria-hidden', 'false');

  setTimeout(() => overlayContent?.focus(), 0);
}

function closeOverlay() {
  if (!overlay) return;
  overlay.classList.remove('is-open');
  overlay.setAttribute('aria-hidden', 'true');
}


document.addEventListener('keydown', (e) => {
  if (e.key === 'Escape') closeOverlay();
}, { passive: true });

overlay?.addEventListener('click', (e) => {
  const target = e.target;
  if (target && target.hasAttribute('data-dismiss')) {
    closeOverlay();
  }
}, { passive: true });


document.querySelectorAll('.flame').forEach(flame=>{
  flame.addEventListener('click', ()=>{
    if(!flame.classList.contains('lit')) return;
    flame.classList.remove('lit');
    flame.classList.add('out');

    const {x,y} = centerOnScreen(flame);
    spawnConfetti({x,y,count:70,spread:Math.PI*0.9,power:8,size:[4,7]});
    puffAt(x,y);

    setTimeout(()=>{
      if(allOut()){
        const pts = [
          {x: innerWidth*0.15, y: innerHeight*0.75},
          {x: innerWidth*0.5,  y: innerHeight*0.75},
          {x: innerWidth*0.85, y: innerHeight*0.75},
          {x: innerWidth*0.3,  y: innerHeight*0.2},
          {x: innerWidth*0.7,  y: innerHeight*0.2},
        ];
        pts.forEach(pt => spawnConfetti({x:pt.x, y:pt.y, count:180, spread:Math.PI*1.2, power:10, size:[5,9]}));


        setTimeout(() => openOverlay(), 350);
      }
    }, 220);
  }, {passive:true});
});


window.addEventListener('DOMContentLoaded', () => {
  startFlameFlicker();

  const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
  if(!prefersReduced){
    setTimeout(()=>{
      const midX = innerWidth * 0.5, topY = innerHeight * 0.25;
      spawnConfetti({x: midX, y: topY, count: 220, spread: Math.PI*1.2, power: 10, size:[5,9]});
      spawnConfetti({x: innerWidth*0.18, y: topY, count: 140, spread: Math.PI, power: 9, size:[4,8]});
      spawnConfetti({x: innerWidth*0.82, y: topY, count: 140, spread: Math.PI, power: 9, size:[4,8]});
    }, 600);
  }
});
</script>
</body>
</html>